### Note:  Before jumping into the setup instruction, please make sure
           1. You have three running virtual machines (ubuntu-18.04) which represent Cloud, Cloud Worker, and the Edge Worker.
           2. Please make sure you set all three virtual machines' inbound rules type to 'ALL TCP'.
           3. You have cloned this repo under /root on all of these virtual machines.
           4. All to be done as root

# Setting up the Kubernetes & KubeEdge environment
## 1. Docker & Kubernetes Installation
On each of your virtual machines, move to the folder named **'K8s_KubeEdge_Setup_Scripts'** and run the following command:
```bash
./0_node_setup_master.sh
```
 
## 2. Kubernetes Cloud Side Configuration
In the same directory on your **Cloud machine**, open the file named **'1_start_k8s.sh'** and modify the **CLOUD_MACHINE_PUBLIC_IP** to the public IP address of your **Cloud machine**.\
\
After updating the IP address, add the following line to end of the file named .bashrc:
```bash
export KUBECONFIG=/etc/kubernetes/admin.conf
```
To open the file, type
```bash
vim ~/.bashrc
```
Then, to start the kubernetes master node, the run the command:
```bash
./1_start_k8s.sh
```

## 3. Connecting the Cloud with the Cloud Worker
After running the **'1_start_k8s.sh'**, you should see a join command looks like this:
<img width="909" alt="image" src="https://user-images.githubusercontent.com/252020/186497031-6690ddfa-d5df-4dff-bde7-df703b4fcc31.png">

Copy it, and move to the **Cloud Worker** machine, run the installation script(**0_node_setup_master.sh**). After you have installed Docker & Kubernetes, run the join command you just copied from the **Cloud**.\
\
Now, if you go back to the **Cloud** machine and run
```bash
kubectl get nodes -o wide
```
You should see there are two nodes in the list, which look like this:
<img width="1196" alt="image" src="https://user-images.githubusercontent.com/252020/186497975-99e2bdd5-07e3-4aba-8ea7-4220a7b2b3d0.png">

## 4. Installing KubeEdge & Starting Cloud Core
Once you connect the **Cloud** and the **Cloud Worker**, under the same path in your **Cloud Master** machine, open the file named '2_start_cloud_core.sh'.\
\
Modify the **CLOUD_MACHINE_PUBLIC_IP** to the public IP address of your **Cloud Master machine**. Then, run the following command to install KubeEdge and start its cloud core:
```bash
./2_start_cloud_core.sh
```
As a result, you should see a token has been generated by the cloud core looks like this:
```bash
Add token picture
```
Copy the token and move to your **Edge** Machine.


## 5. Connecting the Cloud with the Edge Worker
On your **Edge** machine, run the following three commands one at a time to install KubeEdge and move to the correct directory
```bash
wget  https://github.com/kubeedge/kubeedge/releases/download/v1.9.2/keadm-v1.9.2-linux-amd64.tar.gz
tar zxvf  keadm-v1.9.2-linux-amd64.tar.gz
cd keadm-v1.9.2-linux-amd64/
```
After that, run the following command to let the Edge Worker join into the Cloud cluster
```bash
keadm/keadm join --cloudcore-ipport=$CLOUD_MACHINE_PUBLIC_IP:10000 --token=$token
```
**Note: You need to replace '$CLOUD_MACHINE_PUBLIC_IP' and '$token' to public IP address of your Cloud machine and the token you just copied from the Cloud.**\
\
Now, if you go back to the **Cloud** machine and check the existing nodes by running
```bash
kubectl get nodes -o wide
```
You should see something looks like:
```bash
Add 3 nodes picture
```
\
If you see the above nodes status on your **Cloud** machine, congratulations! You have successfully set up the Kubernetes & KubeEdge environment for the nodes!

\
&nbsp;

**Additional Notes:**\
\
**1. To stop the kubernetes on Cloud or Cloud Worker, run**
```bash
kubeadm reset
```
**2. To stop the KubeEdge on Cloud or Edge Worker, if you are under the /root, then run**
```bash
./keadm-v1.9.2-linux-amd64/keadm/keadm reset
```
**3. No installations are needed after resetting. To restart the Cloud of kubernetes or KubeEdge, just simply run the 'init' command.**\
**4. To add Cloud Worker or Edge Worker, simply run the 'join' command used above with the proper token.**


